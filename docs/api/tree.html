<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>svv.tree.Tree - svVascularize API</title>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" />
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="style_api.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Shared top navigation -->
    <header class="topnav">
        <div class="container">
            <h1>svVascularize</h1>
            <nav>
                <a href="../index.html#about">About</a>
                <a href="../install.html">Installation</a>
                <a href="../doc.html">Documentation</a>
                <a href="../index.html#simulation">Simulation</a>
                <a href="https://pypi.org/project/svv/" target="_blank" rel="noopener">PyPI</a>
                <a href="https://github.com/SimVascular/svVascularize" target="_blank" rel="noopener">GitHub</a>
            </nav>
        </div>
    </header>

    <!-- Breadcrumbs -->
    <div class="container">
        <nav class="api-breadcrumbs">
            <a href="../doc.html">Documentation</a>
            <span class="separator">/</span>
            <a href="index_api.html">API Reference</a>
            <span class="separator">/</span>
            <a href="index_api.html#module-tree">svv.tree</a>
            <span class="separator">/</span>
            <span>Tree</span>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="container api-container">
        <!-- Class Header -->
        <div class="api-class-header">
            <h1><code>svv.tree.Tree</code></h1>
            <div class="api-badges">
                <span class="api-module-badge">Core Class</span>
                <span class="api-version-badge">v1.0.0</span>
            </div>
        </div>

        <!-- Class Description -->
        <div class="api-class-description">
            <p>
                The Tree class defines a branching tree structure that is used to abstract the physical representation
                of the generated vascular network. It implements stochastic constructive optimization algorithms
                for growing vascular trees within defined domains.
            </p>
            <p>
                Trees grow iteratively by adding vessels using optimized bifurcation placement, managing collision
                detection, and maintaining physiological constraints. The class provides export capabilities for
                3D models, centerlines, and simulation-ready geometries.
            </p>
        </div>

        <!-- Quick Example -->
        <div class="api-quick-example">
            <h2>Quick Example</h2>
            <pre data-copy><code class="language-python">from svv.tree.tree import Tree
from svv.domain.domain import Domain
import pyvista as pv

# Create domain from mesh
mesh = pv.read('tissue_region.stl')
domain = Domain(mesh)
domain.create()
domain.solve()
domain.build()

# Initialize tree
tree = Tree()
tree.set_domain(domain)

# Set root position
tree.set_root([0, 0, 0])  # Starting point

# Grow tree with n terminals
tree.n_add(100)  # Add 100 vessels

# Visualize
tree.show()

# Export results
solid_model = tree.export_solid()
centerlines, polys = tree.export_centerlines()</code></pre>
        </div>

        <!-- Main Documentation Grid -->
        <div class="api-grid">
            <!-- Left Navigation -->
            <aside class="api-sidebar">
                <div class="sidebar-section">
                    <h4 class="sidebar-title">Contents</h4>
                    <nav class="api-sidebar-nav">
                        <ul>
                            <li><a href="#constructor"><i class="fas fa-hammer"></i> Constructor</a></li>
                            <li><a href="#attributes"><i class="fas fa-database"></i> Attributes</a></li>
                            <li><a href="#parameters"><i class="fas fa-sliders-h"></i> TreeParameters</a></li>
                            <li><a href="#setup-methods"><i class="fas fa-cog"></i> Setup Methods</a></li>
                            <li><a href="#growth-methods"><i class="fas fa-seedling"></i> Growth Methods</a></li>
                            <li><a href="#export-methods"><i class="fas fa-file-export"></i> Export Methods</a></li>
                            <li><a href="#persistence"><i class="fas fa-save"></i> Persistence</a></li>
                            <li><a href="#visualization"><i class="fas fa-eye"></i> Visualization</a></li>
                            <li><a href="#examples"><i class="fas fa-code"></i> Examples</a></li>
                            <li><a href="#performance"><i class="fas fa-tachometer-alt"></i> Performance</a></li>
                        </ul>
                    </nav>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="api-main-content">
                <!-- Constructor Section -->
                <section id="constructor" class="api-section">
                    <h2>Constructor</h2>

                    <div class="api-signature">
                        <code>Tree(*, parameters=None, unit_system=None, preallocation_step=4000000)</code>
                    </div>

                    <p>Initialize an empty tree structure. The tree must be configured with a domain and root before growth.</p>

                    <div class="api-parameters">
                        <h3>Parameters</h3>
                        <table class="api-table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Default</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>parameters</code></td>
                                    <td>TreeParameters</td>
                                    <td>None</td>
                                    <td>Pre-configured parameters object. If None, creates default parameters.</td>
                                </tr>
                                <tr>
                                    <td><code>unit_system</code></td>
                                    <td>UnitSystem</td>
                                    <td>None</td>
                                    <td>Unit system for physical quantities (CGS by default). Ignored if <code>parameters</code> is provided.</td>
                                </tr>
                                <tr>
                                    <td><code>preallocation_step</code></td>
                                    <td>int</td>
                                    <td>4,000,000</td>
                                    <td>Number of vessel segments to preallocate. Larger values reduce reallocations during growth but use more memory.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="api-example">
                        <h4>Constructor Examples</h4>
                        <pre data-copy><code class="language-python">from svv.tree.tree import Tree
from svv.tree.data.data import TreeParameters
from svv.tree.data.units import UnitSystem

# Default tree (CGS units)
tree = Tree()

# Tree with SI units
si_units = UnitSystem(length='m', mass='kg', time='s')
tree_si = Tree(unit_system=si_units)

# Tree with custom parameters
params = TreeParameters()
params.murray_exponent = 2.7
params.terminal_pressure = 60.0  # mmHg equivalent in CGS
tree_custom = Tree(parameters=params)

# Memory-optimized tree for smaller networks
tree_small = Tree(preallocation_step=10000)</code></pre>
                    </div>
                </section>

                <!-- Attributes Section -->
                <section id="attributes" class="api-section">
                    <h2>Attributes</h2>

                    <h3>Core Data Structures</h3>
                    <table class="api-table">
                        <thead>
                            <tr>
                                <th>Attribute</th>
                                <th>Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>data</code></td>
                                <td>TreeData</td>
                                <td>Main data structure containing vessel geometry and properties</td>
                            </tr>
                            <tr>
                                <td><code>parameters</code></td>
                                <td>TreeParameters</td>
                                <td>Configuration parameters for tree growth</td>
                            </tr>
                            <tr>
                                <td><code>vessel_map</code></td>
                                <td>TreeMap</td>
                                <td>Mapping of vessel connectivity and hierarchy</td>
                            </tr>
                            <tr>
                                <td><code>domain</code></td>
                                <td>Domain</td>
                                <td>Spatial domain constraining tree growth</td>
                            </tr>
                            <tr>
                                <td><code>connectivity</code></td>
                                <td>np.ndarray</td>
                                <td>Connectivity matrix for vessel segments</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Tree Properties</h3>
                    <table class="api-table">
                        <thead>
                            <tr>
                                <th>Attribute</th>
                                <th>Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>n_terminals</code></td>
                                <td>int</td>
                                <td>Current number of terminal vessels</td>
                            </tr>
                            <tr>
                                <td><code>segment_count</code></td>
                                <td>int</td>
                                <td>Total number of vessel segments</td>
                            </tr>
                            <tr>
                                <td><code>tree_scale</code></td>
                                <td>float</td>
                                <td>Total tree volume scale factor</td>
                            </tr>
                            <tr>
                                <td><code>characteristic_length</code></td>
                                <td>float</td>
                                <td>Characteristic length from domain</td>
                            </tr>
                            <tr>
                                <td><code>physical_clearance</code></td>
                                <td>float</td>
                                <td>Minimum physical spacing between vessels</td>
                            </tr>
                            <tr>
                                <td><code>convex</code></td>
                                <td>bool</td>
                                <td>Whether domain is treated as convex</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Internal Structures</h3>
                    <table class="api-table">
                        <thead>
                            <tr>
                                <th>Attribute</th>
                                <th>Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>kdtm</code></td>
                                <td>KDTreeManager</td>
                                <td>KD-tree for spatial queries</td>
                            </tr>
                            <tr>
                                <td><code>hnsw_tree</code></td>
                                <td>USearchTree</td>
                                <td>HNSW index for fast nearest neighbor search</td>
                            </tr>
                            <tr>
                                <td><code>times</code></td>
                                <td>dict</td>
                                <td>Performance timing statistics</td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <!-- TreeParameters Section -->
                <section id="parameters" class="api-section">
                    <h2>TreeParameters</h2>

                    <p>The <code>TreeParameters</code> class holds physical and algorithmic settings that steer tree generation.
                    Parameters are stored in the unit system referenced by <code>unit_system</code>. By default, the
                    centimetre-gram-second (CGS) convention is used.</p>

                    <div class="api-signature">
                        <code>TreeParameters(*, unit_system=None)</code>
                    </div>

                    <h3>Attributes</h3>
                    <table class="api-table">
                        <thead>
                            <tr>
                                <th>Attribute</th>
                                <th>Type</th>
                                <th>Default (CGS)</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>unit_system</code></td>
                                <td>UnitSystem</td>
                                <td>CGS</td>
                                <td>Active unit system governing numerical values</td>
                            </tr>
                            <tr>
                                <td><code>kinematic_viscosity</code></td>
                                <td>float</td>
                                <td>0.036 cm²/s</td>
                                <td>Blood kinematic viscosity</td>
                            </tr>
                            <tr>
                                <td><code>fluid_density</code></td>
                                <td>float</td>
                                <td>1.06 g/cm³</td>
                                <td>Blood mass density</td>
                            </tr>
                            <tr>
                                <td><code>murray_exponent</code></td>
                                <td>float</td>
                                <td>3.0</td>
                                <td>Murray's law exponent for radius scaling at bifurcations</td>
                            </tr>
                            <tr>
                                <td><code>radius_exponent</code></td>
                                <td>float</td>
                                <td>2.0</td>
                                <td>Exponent for radius contribution to cost function</td>
                            </tr>
                            <tr>
                                <td><code>length_exponent</code></td>
                                <td>float</td>
                                <td>1.0</td>
                                <td>Exponent for length contribution to cost function</td>
                            </tr>
                            <tr>
                                <td><code>terminal_pressure</code></td>
                                <td>float</td>
                                <td>60 mmHg</td>
                                <td>Pressure at terminal vessels (capillary bed)</td>
                            </tr>
                            <tr>
                                <td><code>root_pressure</code></td>
                                <td>float</td>
                                <td>100 mmHg</td>
                                <td>Pressure at the root vessel (inlet)</td>
                            </tr>
                            <tr>
                                <td><code>terminal_flow</code></td>
                                <td>float</td>
                                <td>6.25e-5 cm³/s</td>
                                <td>Volumetric flow per terminal vessel</td>
                            </tr>
                            <tr>
                                <td><code>root_flow</code></td>
                                <td>float or None</td>
                                <td>None</td>
                                <td>Total flow at root (computed during growth if None)</td>
                            </tr>
                            <tr>
                                <td><code>max_nonconvex_count</code></td>
                                <td>int</td>
                                <td>100</td>
                                <td>Max attempts before switching to convex mode in non-convex domains</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Methods</h3>

                    <div class="api-method">
                        <div class="api-method-signature">
                            <code>set(parameter, value, *, unit=None)</code>
                        </div>
                        <p>Update a named parameter with optional unit conversion.</p>
                        <div class="api-method-params">
                            <h4>Parameters</h4>
                            <ul>
                                <li><code>parameter</code> (str): Parameter name (e.g., 'kinematic_viscosity', 'murray_exponent')</li>
                                <li><code>value</code>: New value</li>
                                <li><code>unit</code> (str or UnitSystem, optional): Source unit for conversion</li>
                            </ul>
                        </div>
                    </div>

                    <div class="api-method">
                        <div class="api-method-signature">
                            <code>set_unit_system(unit_system, *, convert_existing=True)</code>
                        </div>
                        <p>Switch to a new unit system, optionally converting existing values.</p>
                        <div class="api-method-params">
                            <h4>Parameters</h4>
                            <ul>
                                <li><code>unit_system</code> (UnitSystem): Target unit system</li>
                                <li><code>convert_existing</code> (bool): If True, convert stored values to new units</li>
                            </ul>
                        </div>
                    </div>

                    <div class="api-example">
                        <h4>TreeParameters Examples</h4>
                        <pre data-copy><code class="language-python">from svv.tree.data.data import TreeParameters
from svv.tree.data.units import UnitSystem

# Create parameters with defaults
params = TreeParameters()
print(params)
# Tree Parameters:
# ----------------
# Kinematic Viscosity: 0.036 cm^2/s
# Fluid Density: 1.06 g/cm^3
# Murray Exponent: 3.0
# ...

# Modify parameters
params.murray_exponent = 2.7  # Direct assignment
params.set('terminal_pressure', 80.0, unit='mmHg')  # With unit conversion

# Create SI parameters
si_system = UnitSystem(length='m', mass='kg', time='s', pressure='Pa')
params_si = TreeParameters(unit_system=si_system)

# Convert existing parameters to SI
params.set_unit_system(si_system, convert_existing=True)</code></pre>
                    </div>

                    <div class="callout tip">
                        <strong>Murray's Law:</strong> The <code>murray_exponent</code> (typically 2.7-3.0) controls how
                        parent vessel radius relates to daughter radii at bifurcations. A value of 3.0 minimizes power
                        dissipation; lower values (2.0-2.5) are observed in some vascular beds.
                    </div>
                </section>

                <!-- Setup Methods Section -->
                <section id="setup-methods" class="api-section">
                    <h2>Setup Methods</h2>

                    <div class="api-method">
                        <div class="api-method-signature">
                            <code>set_domain(domain, convexity_tolerance=1e-2)</code>
                        </div>
                        <p>Set the spatial domain for tree growth.</p>
                        <div class="api-method-params">
                            <h4>Parameters</h4>
                            <ul>
                                <li><code>domain</code> (Domain): Domain object defining growth region</li>
                                <li><code>convexity_tolerance</code> (float): Tolerance for convexity check</li>
                            </ul>
                            <h4>Notes</h4>
                            <p>The domain must have its implicit function built before setting. The method automatically
                            determines if the domain is convex, which affects collision detection strategies.</p>
                        </div>
                    </div>

                    <div class="api-method">
                        <div class="api-method-signature">
                            <code>set_root(*args, inplace=True, **kwargs)</code>
                        </div>
                        <p>Set the root vessel of the tree.</p>
                        <div class="api-method-params">
                            <h4>Parameters</h4>
                            <ul>
                                <li><code>*args</code>: Variable arguments
                                    <ul>
                                        <li>Single argument: starting point (3D coordinates)</li>
                                        <li>Two arguments: starting point and direction vector</li>
                                    </ul>
                                </li>
                                <li><code>inplace</code> (bool): Modify tree in place</li>
                                <li><code>**kwargs</code>: Additional parameters for root configuration</li>
                            </ul>
                            <h4>Notes</h4>
                            <p>When direction is provided, the root becomes "clamped" with fixed orientation.</p>
                        </div>
                    </div>
                </section>

                <!-- Growth Methods Section -->
                <section id="growth-methods" class="api-section">
                    <h2>Growth Methods</h2>

                    <div class="api-method">
                        <div class="api-method-signature">
                            <code>add(inplace=True, **kwargs)</code>
                        </div>
                        <p>Add a single vessel to the tree using optimized bifurcation placement.</p>
                        <div class="api-method-params">
                            <h4>Parameters</h4>
                            <ul>
                                <li><code>inplace</code> (bool): Modify tree in place</li>
                                <li><code>decay_probability</code> (float, default=0.9): Probability decay for revisiting regions</li>
                                <li><code>**kwargs</code>: Additional growth parameters</li>
                            </ul>
                            <h4>Returns</h4>
                            <ul>
                                <li>If <code>inplace=True</code>: None</li>
                                <li>If <code>inplace=False</code>: Tuple of modification data</li>
                            </ul>
                            <h4>Algorithm</h4>
                            <p>The method uses constructive constrained optimization (CCO) to find optimal bifurcation
                            points that minimize total tree volume while maintaining flow constraints.</p>
                        </div>
                    </div>

                    <div class="api-method">
                        <div class="api-method-signature">
                            <code>n_add(n, **kwargs)</code>
                        </div>
                        <p>Add multiple vessels to the tree.</p>
                        <div class="api-method-params">
                            <h4>Parameters</h4>
                            <ul>
                                <li><code>n</code> (int): Number of vessels to add</li>
                                <li><code>**kwargs</code>: Parameters passed to each <code>add()</code> call</li>
                            </ul>
                            <h4>Notes</h4>
                            <p>Shows a progress bar during growth. Each vessel is added sequentially with
                            the tree structure updated after each addition.</p>
                        </div>
                    </div>
                </section>

                <!-- Export Methods Section -->
                <section id="export-methods" class="api-section">
                    <h2>Export Methods</h2>

                    <div class="api-method">
                        <div class="api-method-signature">
                            <code>export_solid(outdir=None, shell_thickness=0.0, watertight=False, **kwargs)</code>
                        </div>
                        <p>Export tree as a 3D solid model.</p>
                        <div class="api-method-params">
                            <h4>Parameters</h4>
                            <ul>
                                <li><code>outdir</code> (str, optional): Output directory path</li>
                                <li><code>shell_thickness</code> (float): Wall thickness for hollow vessels</li>
                                <li><code>watertight</code> (bool): Create watertight mesh with smooth junctions</li>
                            </ul>
                            <h4>Returns</h4>
                            <ul>
                                <li><code>model</code> (pv.PolyData): 3D mesh of the vascular tree</li>
                            </ul>
                        </div>
                    </div>

                    <div class="api-method">
                        <div class="api-method-signature">
                            <code>export_centerlines(outdir=None, **kwargs)</code>
                        </div>
                        <p>Export tree centerlines for simulation or analysis.</p>
                        <div class="api-method-params">
                            <h4>Returns</h4>
                            <ul>
                                <li><code>centerlines</code> (pv.PolyData): Centerline geometry</li>
                                <li><code>polys</code>: Connectivity information</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- Persistence Section -->
                <section id="persistence" class="api-section">
                    <h2>Persistence (Save/Load)</h2>

                    <p>Trees can be saved to and loaded from <code>.tree</code> files, enabling checkpointing during
                    long growth processes and sharing of generated vascular structures.</p>

                    <div class="api-method">
                        <div class="api-method-signature">
                            <code>save(path, include_timing=False)</code>
                        </div>
                        <p>Save the tree to a <code>.tree</code> file.</p>
                        <div class="api-method-params">
                            <h4>Parameters</h4>
                            <ul>
                                <li><code>path</code> (str): Output filename. If no extension is provided, <code>.tree</code> is appended.</li>
                                <li><code>include_timing</code> (bool): Include generation timing data for profiling/debugging. Default is False.</li>
                            </ul>
                            <h4>Notes</h4>
                            <p>The saved file contains all tree data, parameters, and connectivity information needed
                            to reconstruct the tree. <strong>The domain is NOT saved</strong> and must be set separately
                            after loading via <code>set_domain()</code>.</p>
                        </div>
                    </div>

                    <div class="api-method">
                        <div class="api-method-signature">
                            <code>Tree.load(path)</code>  <span class="api-badge">classmethod</span>
                        </div>
                        <p>Load a tree from a <code>.tree</code> file.</p>
                        <div class="api-method-params">
                            <h4>Parameters</h4>
                            <ul>
                                <li><code>path</code> (str): Path to a <code>.tree</code> file.</li>
                            </ul>
                            <h4>Returns</h4>
                            <ul>
                                <li><code>Tree</code>: Loaded tree instance.</li>
                            </ul>
                            <h4>Notes</h4>
                            <p>The loaded tree will NOT have a domain set. You must call <code>set_domain()</code>
                            after loading to enable domain-dependent operations like collision detection.</p>
                        </div>
                    </div>

                    <div class="api-example">
                        <h4>Save/Load Example</h4>
                        <pre data-copy><code class="language-python">from svv.tree.tree import Tree
from svv.domain.domain import Domain
import pyvista as pv

# Create and grow a tree
domain = Domain(pv.Cube())
domain.create()
domain.solve()
domain.build()

tree = Tree()
tree.set_domain(domain)
tree.set_root()
tree.n_add(100)

# Save the tree
tree.save("my_vascular_tree.tree")

# Later, load it back
loaded_tree = Tree.load("my_vascular_tree.tree")

# Re-attach the domain for further operations
loaded_tree.set_domain(domain)

# Continue growing or export
loaded_tree.n_add(50)
loaded_tree.show()</code></pre>
                    </div>

                    <div class="callout warning">
                        <strong>Domain Not Saved:</strong> The domain implicit function can be expensive to compute
                        and is not serialized with the tree. Save your domain separately using <code>domain.save()</code>
                        if you need to preserve the complete workspace.
                    </div>
                </section>

                <!-- Visualization Section -->
                <section id="visualization" class="api-section">
                    <h2>Visualization</h2>

                    <div class="api-method">
                        <div class="api-method-signature">
                            <code>show(**kwargs)</code>
                        </div>
                        <p>Display interactive 3D visualization of the tree.</p>
                        <div class="api-method-params">
                            <h4>Parameters</h4>
                            <ul>
                                <li><code>color</code> (str): Vessel color (default: 'red')</li>
                                <li><code>plot_domain</code> (bool): Display domain boundary</li>
                                <li><code>return_plotter</code> (bool): Return the PyVista plotter instead of showing</li>
                                <li><code>**kwargs</code>: Additional PyVista plotting parameters</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- Examples Section -->
                <section id="examples" class="api-section">
                    <h2>Examples</h2>

                    <div class="api-example">
                        <h3>Basic Tree Generation</h3>
                        <pre data-copy><code class="language-python">from svv.tree.tree import Tree
from svv.domain.domain import Domain
import numpy as np
import pyvista as pv

# Create spherical domain
sphere = pv.Sphere(radius=10.0, center=(0, 0, 0))
domain = Domain(sphere)
domain.create()
domain.solve()
domain.build(resolution=30)

# Initialize and configure tree
tree = Tree()
tree.set_domain(domain)
tree.parameters.radius_exponent = 2.0  # Murray's law
tree.parameters.length_exponent = 1.0

# Set root at center
tree.set_root([0, 0, 0])

# Grow tree
tree.n_add(50)

# Show statistics
print(f"Terminals: {tree.n_terminals}")
print(f"Segments: {tree.segment_count}")
print(f"Tree scale: {tree.tree_scale:.3f}")

# Visualize
tree.show(color='royalblue', plot_domain=True)</code></pre>
                    </div>

                    <div class="api-example">
                        <h3>Constrained Growth with Physical Clearance</h3>
                        <pre data-copy><code class="language-python"># Set minimum vessel spacing
tree = Tree()
tree.physical_clearance = 0.5  # mm minimum spacing
tree.set_domain(domain)

# Root with fixed direction
start_point = [0, 0, -5]
direction = [0, 0, 1]
tree.set_root(start_point, direction)

# Grow with custom parameters
for i in range(100):
    tree.add(decay_probability=0.95)

    # Check growth progress
    if i % 20 == 0:
        print(f"Step {i}: {tree.n_terminals} terminals")

# Export results
solid = tree.export_solid(watertight=True)
solid.save('vascular_tree.stl')</code></pre>
                    </div>

                    <div class="api-example">
                        <h3>Export for Simulation</h3>
                        <pre data-copy><code class="language-python">import numpy as np
# Generate tree
tree = Tree()
tree.set_domain(domain)
tree.set_root([0, 0, 0])
tree.n_add(100)

# Export centerlines with radius data
centerlines, connectivity = tree.export_centerlines()

# Add flow properties
centerlines['flow_rate'] = np.zeros(centerlines.n_points)
centerlines['pressure'] = np.ones(centerlines.n_points) * 80  # mmHg

# Save for simulation
centerlines.save('tree_centerlines.vtp')

# Export solid model
solid = tree.export_solid(
    watertight=True,
    shell_thickness=0.1  # Create hollow vessels
)
solid.save('tree_solid.stl')

# Access raw data for custom processing
vessel_data = tree.data  # TreeData object
vessel_map = tree.vessel_map  # Connectivity information</code></pre>
                    </div>
                </section>

                <!-- Performance Section -->
                <section id="performance" class="api-section">
                    <h2>Performance Considerations</h2>

                    <div class="admonition info">
                        <p><strong>Spatial Indexing:</strong> The Tree class uses multiple spatial data structures for efficient
                        collision detection: KD-trees for exact nearest neighbor queries and HNSW (Hierarchical Navigable
                        Small World) graphs for approximate nearest neighbor search in high-dimensional spaces.</p>
                    </div>

                    <div class="admonition note">
                        <p><strong>Memory Management:</strong> Trees preallocate memory in chunks (default 4 million segments)
                        to avoid repeated allocations during growth. This significantly improves performance for large trees.</p>
                    </div>

                    <div class="admonition warning">
                        <p><strong>Convexity:</strong> Non-convex domains require additional collision checks which can slow
                        growth. The tree automatically switches to convex mode after repeated failures in non-convex regions
                        (controlled by <code>parameters.max_nonconvex_count</code>).</p>
                    </div>

                    <h3>Timing Analysis</h3>
                    <p>Access detailed timing information through the <code>times</code> attribute:</p>
                        <pre data-copy><code class="language-python"># After growing tree
import numpy as np
import pandas as pd

# Convert timing data to DataFrame
timing_df = pd.DataFrame(tree.times)

# Analyze performance bottlenecks
print("Average times (ms):")
for key in ['vessels', 'collision', 'local_optimization']:
    if key in tree.times and tree.times[key]:
        avg_time = np.mean(tree.times[key]) * 1000
        print(f"{key}: {avg_time:.2f}")</code></pre>
                </section>

                <!-- See Also Section -->
                <section class="api-section">
                    <h2>See Also</h2>
                    <ul>
                        <li><a href="domain.html"><code>svv.domain.Domain</code></a> - Spatial domains for tree growth</li>
                        <li><a href="forest.html"><code>svv.forest.Forest</code></a> - Collections of multiple trees</li>
                        <!-- <li><a href="data.html"><code>svv.tree.data.TreeData</code></a> - Tree data structure details</li>
                        <li><a href="parameters.html"><code>svv.tree.TreeParameters</code></a> - Growth parameter configuration</li> -->
                    </ul>
                </section>
            </main>

            <!-- Right TOC -->
            <aside class="api-toc-sidebar">
                <div class="sidebar-section">
                    <h4 class="sidebar-title">On This Page</h4>
                    <nav id="local-toc" class="api-local-toc">
                        <!-- Auto-populated by JavaScript -->
                    </nav>
                </div>
            </aside>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p>&copy; 2025 SimVascular, Stanford University, The Regents of the University of California, and others –
            <a href="https://opensource.org/license/BSD-3-Clause">BSD 3-Clause License</a><br></p>
        </div>
    </footer>

    <!-- Additional styles for this page -->
    <style>
        .api-class-header {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 3px solid var(--clr-primary-400);
        }

        .api-class-header h1 {
            margin: 0;
            font-family: Consolas, monospace;
            color: var(--clr-primary-700);
        }

        .api-badges {
            margin-top: 0.5rem;
            display: flex;
            gap: 0.5rem;
        }

        .api-class-description {
            background: var(--clr-grey-100);
            border-left: 4px solid var(--clr-primary-400);
            padding: 1rem;
            border-radius: var(--radius-sm);
            margin-bottom: 2rem;
        }

        .api-method {
            background: var(--clr-surface);
            border: 1px solid var(--clr-grey-300);
            border-radius: var(--radius-sm);
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .api-method-signature {
            background: var(--clr-grey-100);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-sm);
            font-family: Consolas, monospace;
            margin-bottom: 0.75rem;
        }

        .api-method-params h4 {
            color: var(--clr-primary-700);
            font-size: 0.9rem;
            margin-top: 0.75rem;
            margin-bottom: 0.5rem;
        }
    </style>

    <!-- Load Scripts -->
    <script defer src="../script.js"></script>
    <script defer src="script_api.js"></script>
</body>
</html>
