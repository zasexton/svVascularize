<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CCO Algorithm · svVascularize Docs</title>
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />

    <!-- MathJax: render \( ... \) and \[ ... \]; add argmin/argmax; ignore code/pre -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['\\(','\\)']],
        displayMath: [['\\[','\\]']],
        packages: {'[+]': ['base','ams']},
        macros: {
          argmin: '\\operatorname*{arg\\,min}',
          argmax: '\\operatorname*{arg\\,max}'
        }
      },
      options: {
        skipHtmlTags: ['script','noscript','style','textarea','pre','code']
      }
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</head>
<body>
  <!-- Shared top navigation (copied from doc.html) -->
  <header class="topnav">
    <div class="container">
      <h1>svVascularize</h1>
      <nav>
        <a href="index.html#about">About</a>
        <a href="install.html">Installation</a>
        <a class="active" href="doc.html">Documentation</a>
        <a href="index.html#simulation">Simulation</a>
        <a href="https://pypi.org/project/svv/" target="_blank" rel="noopener">PyPI</a>
        <a href="https://github.com/SimVascular/svVascularize" target="_blank" rel="noopener">GitHub</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="container">
      <h2>Stochastic Constructive Optimization for Vascular Network Design</h2>
      <p></p>
      <a class="cta" href="doc.html">Back to Docs</a>
    </div>
  </section>

  <main class="container content">

    <h2 id="overview">Overview</h2>
    <p>
      Stochastic constructive design optimization refers to a class of algorithms that build complex structures
        iteratively by adding components (e.g. vessel segments) in accordance to some optimization rules and some
        additional constraints. In vascular modeling, the prototypical example is <strong>Constrained Constructive
        Optimization (CCO)</strong>-an algorithm introduced by <a href="https://ieeexplore.ieee.org/document/243413" target="_blank" rel="noopener">Schreiner &amp; Buxbaum (1993)</a>
        for generating arterial trees. CCO and its related algorithms have become gold-standard techniques for
        synthesizing plausible vascular networks in silico <a href="https://pubmed.ncbi.nlm.nih.gov/10207653/" target="_blank" rel="noopener">Karch et&nbsp;al. (1999)</a>.
        Recent open implementations (e.g.,
        <a href="https://www.ipol.im/pub/art/2023/477/" target="_blank" rel="noopener">OpenCCO</a>) and adaptive variants
        (<a href="https://www.nature.com/articles/s41598-021-85434-9" target="_blank" rel="noopener">Sci Rep 2021</a>)
        have continued to extend the capabilities of this group of algorithms.

        These algorithms strive to mimic physiological design principles including balancing metabolic supply and pumping energy
        (Murray's Law) so that synthetic vessels closely resemble the geometry and hemodynamics of native networks.
        The construction is stochastic because each new vessel insertion involves a random or pseudo-random sampling of
        points within the build space followed by appropriate constraints and an optimization step to integrate that
        vessel at a bifurcation point. Over many iterations, this yields a branching network that "grows" throughout
        the build space. Often, these networks exhibit fractal-like properties reminiscent of native blood vessels.
        These algorithms are powerful in biomedical research, allowing investigators to simulate microvascular
        architectures for different organs, conditions, or species where imaging data is sparse.

    </p>

    <div class="callout tip">
      Think of CCO as “grow a vessel → optimize locally → check constraints → accept → repeat,” ensuring you never
      stray far from a valid solution.
    </div>

    <h2 id="core-ideas">Core ideas</h2>
    <ul>
      <li><strong>Constructive growth:</strong> Start from a seed; add elements (nodes, segments, primitives) one at a time.</li>
      <li><strong>Feasibility at every step:</strong> Enforce hard constraints (e.g., geometry, non-overlap, boundary conditions) during growth.</li>
      <li><strong>Local optimization:</strong> After each addition, adjust a small neighborhood (topology, positions, radii, weights) to improve an objective.</li>
      <li><strong>Greedy–stochastic blend:</strong> Explore candidates stochastically; accept using greedy or tempered criteria.</li>
      <li><strong>Anytime property:</strong> You can stop early and still have a valid, usable design.</li>
    </ul>

    <h2 id="cycle">One growth cycle</h2>
    <figure class="figure-center">
      <!-- Put your exported figure here; path may be assets/cco_growth_cycle.svg or .png -->
      <img src="graphics/growth_cycle.jpg" alt="CCO growth cycle panels A–E with fixed target X." style="max-width:100%; border:2px solid #000;"/>
      <figcaption>CCO growth (single iteration). Target <strong>X</strong> is fixed across panels.</figcaption>
    </figure>

    <h2 id="notation">Local Bifurcation Optimization</h2>
    <p>For a fixed target \(X\), choose the best feasible proposal \(p\) by minimizing an objective \(J\):</p>
    <div class="mathblock">
      \[
        p^{*}(X)=\argmin_{p\in \mathcal{P}(X)} J\!\big(\mathcal{T}_k \oplus p\big)
        \quad\text{s.t.}\quad p\in\mathcal{F} \;(\text{non-intersection, domain, degree}).
      \]
      \[
        \mathcal{T}_{k+1}=S_k \oplus p^{*}(X).
      \]
    </div>
    <p>Local refinement (bifurcation position \(b\) and radii \(r\)) over a neighborhood \(\mathcal{N}\):</p>
    <div class="mathblock">
      \[
        (b^{*},r^{*})=\argmin_{(b,r)\in \mathcal{N}}
        J\!\big(S_k \oplus p(b,r)\big)
        \quad\text{(Poiseuille flow, Murray-style constraints).}
      \]
    </div>
      <p>
      In practice, \(J\) is a <em>penalized composite</em> that combines hemodynamic power
      \(\sum_i R_i Q_i^2\) with geometric costs (e.g., total volume/length and smoothness/turning penalties);
      the flows \(Q_i\) are obtained from a fast 0D (Poiseuille) solve for each candidate.
      <em>Hard</em> constraints (domain inclusion, segment–segment clearance, degree limits) are enforced as feasibility
      filters—candidates failing a cheap pre-check are discarded—or equivalently via an indicator
      \(\iota_{\mathcal{F}}(p)\in\{0,\infty\}\) added to \(J\).
      <em>Soft</em> constraints (angle/taper bounds, min radius, curvature) are added as penalties,
      e.g., \(\mu\sum_i \big[\!g_i(p)\big]_+^2+\nu\sum_j h_j(p)^2\); the Murray relation
      \(r_0^{\,n}=r_1^{\,n}+r_2^{\,n}\) (typically \(n\approx 3\)) is enforced either exactly (equality) or via a strong penalty while optimizing \(b\) and \(r\).
      The local search is low-dimensional in practice: move \(b\) along a bounded segment/plane and update radii from the flow split,
      using a short line search or trust-region step; the accepted proposal is the feasible candidate with the smallest penalized \(J\),
      otherwise the routine resamples/relaxes (anneals) if no candidate passes.
    </p>
    <h2 id="typical-pipeline">Typical CCO pipeline</h2>
    <ol>
      <li><strong>Initialize</strong> a feasible seed (root node, inlet, or minimal skeleton).</li>
      <li><strong>Sample a target</strong> (demand point, region of interest, or heuristic focus).</li>
      <li><strong>Propose connections</strong> from the existing structure to the target (multiple candidates).</li>
      <li><strong>Project &amp; sanitize</strong> into valid space (snap to domain, avoid collisions/violations).</li>
      <li><strong>Local optimize</strong> the neighborhood (positions, radii/weights, minor topology tweaks).</li>
      <li><strong>Evaluate constraints</strong> and <strong>score</strong> the objective (with penalties for soft rules).</li>
      <li><strong>Select</strong> the best feasible candidate; <strong>commit</strong> to the structure.</li>
      <li><strong>Repeat</strong> until coverage/quality targets are met or a budget is exhausted.</li>
    </ol>

    <h2 id="objective-constraints">Objectives &amp; constraints</h2>
    <table>
      <thead>
        <tr><th>Type</th><th>Examples</th><th>Notes</th></tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Objective</strong></td>
          <td>Minimize cost/length, imbalance, pressure drop, or a weighted composite</td>
          <td>Often additive across elements; may include regularizers.</td>
        </tr>
        <tr>
          <td><strong>Hard constraints</strong></td>
          <td>Geometric validity, non-intersection, boundary inclusion, degree limits</td>
          <td>Must hold at every step; violated candidates are rejected.</td>
        </tr>
        <tr>
          <td><strong>Soft constraints</strong></td>
          <td>Preferred angles, tapering rules, smoothness</td>
          <td>Typically encoded as penalties in the objective.</td>
        </tr>
      </tbody>
    </table>

    <h2 id="data-structures">Data structures that help</h2>
    <ul>
      <li><strong>Spatial index</strong> (k-d tree, BVH) for nearest-neighbor queries and fast collision checks.</li>
      <li><strong>Adjacency graph</strong> (nodes/edges) to update local neighborhoods efficiently.</li>
      <li><strong>Constraint cache</strong> to memoize expensive checks (e.g., local clearance or regional quotas).</li>
      <li><strong>Candidate pool</strong> with ranked proposals and provenance for reproducibility.</li>
    </ul>

    <h2 id="deep-dive">Deep-dive: how this maps to <code>svVascularize</code></h2>
    <p>
      The <a href="https://github.com/SimVascular/svVascularize" target="_blank" rel="noopener">svVascularize</a> API follows the CCO pattern and exposes hooks to control sampling, constraints, and local refinement:
    </p>
    <ul>
      <li><strong>Seed/init:</strong> create a root vessel and initial terminals inside the domain (mesh/voxel/signed-distance). <em>(CCO: minimal feasible \(S_0\)).</em></li>
      <li><strong>Target sampling:</strong> draw a terminal location \(X\) (uniform, blue-noise, or demand-weighted) to improve coverage.</li>
      <li><strong>Candidate proposals:</strong> choose anchors (nearby segments/terminals) and propose a dashed path to \(X\); project into the domain and sanitize (clearance, no self-intersection).</li>
      <li><strong>Local optimization:</strong> refine bifurcation position and daughter radii under Poiseuille/Murray constraints to minimize \(J\).</li>
      <li><strong>Feasibility check:</strong> accept only if hard constraints pass; otherwise resample or relax.</li>
      <li><strong>Commit &amp; update:</strong> add solid segments to obtain \(S_{k+1}\), update flows/pressures and spatial indices.</li>
    </ul>

    <h3 id="objective">Typical objective and constraints</h3>
    <table>
      <thead><tr><th>Type</th><th>Examples</th><th>Notes</th></tr></thead>
      <tbody>
        <tr>
          <td><strong>Objective</strong></td>
          <td>\(J = \alpha\,\text{Power} + \beta\,\text{Volume} + \gamma\,\text{Smoothness}\)</td>
          <td>Weights \(\alpha,\beta,\gamma\) tune energy vs material vs geometry.</td>
        </tr>
        <tr>
          <td><strong>Hard constraints</strong></td>
          <td>Domain inclusion, non-intersection, degree limits, inlet/outlet boundary rules</td>
          <td>Reject on failure (no penalties).</td>
        </tr>
        <tr>
          <td><strong>Soft constraints</strong></td>
          <td>Preferred angles, taper, min/max radius</td>
          <td>Encode as penalties within \(J\).</td>
        </tr>
      </tbody>
    </table>

    <h3 id="pseudocode">Pseudocode for CCO processes</h3>
    <p>The loop below mirrors the implementation pattern.
    <pre data-copy><code class="language-python">def cco(seed, domain, params):
    T = initialize_structure(seed, domain, params)       # T_{0}
    while not done(T, params):
        X = sample_target(domain, T, params)             # fixed target for this iteration
        candidates = []
        for a in select_anchors(T, X, params):
            p = propose(a, X, params)                    # dashed proposal
            p = project_and_sanitize(p, domain, T)       # enforce geometry/bounds
            (b_star, r_star) = local_optimize(p, T, params)
            if hard_constraints_ok(T, p, b_star, r_star, domain):
                score = objective(T, p, b_star, r_star, params)  # J(...)
                candidates.append((score, (p, b_star, r_star)))
        if not candidates:
            handle_stall(T, X, params)                   # resample/relax; keep feasibility
            continue
        _, best = min(candidates, key=lambda t: t[0])     # argmin over feasible
        T = commit(T, *best)                              # accept → T_{k+1}
    return T</code></pre>

    <h2 id="related">Related stochastic generators</h2>
    <ul>
      <li><strong>Simulated-annealing vascular optimization (SALVO):</strong>
        global re-wiring via Metropolis updates; see
        <a href="https://www.nature.com/articles/s41598-021-84432-1" target="_blank" rel="noopener">Sci Rep 2021</a>
        and <a href="https://arxiv.org/pdf/2007.07039" target="_blank" rel="noopener">arXiv 2020</a>.
      </li>
      <li><strong>Growth-based optimization (GBO):</strong>
        tissue-demand-guided constructive growth; see
        <a href="https://link.springer.com/article/10.1007/s10237-023-01703-8" target="_blank" rel="noopener">Kim et&nbsp;al., 2023</a>
        and MRI perfusion validation in
        <a href="https://www.sciencedirect.com/science/article/pii/S0169260723006223" target="_blank" rel="noopener">Rundfeldt et&nbsp;al., 2024</a>.
      </li>
      <li><strong>L-systems / fractal generators:</strong>
        procedural branching with Murray-style rules; e.g.
        <a href="https://tis.wu.ac.th/index.php/tis/article/view/1407" target="_blank" rel="noopener">Ritraksa et&nbsp;al., 2021</a>.
      </li>
      <li><strong>More global formulations:</strong>
        continuous/integer programs or constructive-global hybrids; e.g.
        <a href="https://openscholarship.wustl.edu/cgi/viewcontent.cgi?article=1035&context=cse_research" target="_blank" rel="noopener">WUSTL technical report</a>.
      </li>
    </ul>

    <div class="callout warning">
      Over-tight constraints can cause stalls; use progressive tightening or multi-resolution domains for robustness.
    </div>

    <h2 id="next">Next steps</h2>
    <ul>
      <li><a href="parameter_space.html">Parameter space &amp; sampling strategies</a></li>
      <!-- <li><a href="validation.html">Validation: geometric &amp; hemodynamic checks</a></li> -->
    </ul>
  </main>

  <!-- Footer (copied from doc.html) -->
  <footer>
    <div class="container">
      <p>&copy; 2025 SimVascular, Stanford University, The Regents of the University of California, and others —
      <a href="https://opensource.org/license/BSD-3-Clause">BSD 3-Clause License</a><br></p>
    </div>
  </footer>

  <script defer src="script.js"></script>
</body>
</html>
